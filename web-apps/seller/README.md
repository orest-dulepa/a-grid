# Seller Web App

AGrid's web app for publishers aka **sellers**.


## Stack

This application uses the following front-end stack:
- Vue 2
- Typescript
- Vue cli


## Accounts structure

`accounts/<accountId>/publishers/<publisherId>/apiKeys/<apiKey>`  
`users/<uid>/.accountId = <accountId>`

- The `<accountId>` and `<publisherId>` are unique 6-digit nanoid ids. The `<apiKey>` is a firebase
  generated id. The `<uid>` is the user id that's generated by firebase via
  `createUserWithEmailAndPassword`.
- Each account has at least one publisher, and each publisher has at least one api key.
- A _default_ publisher with a _default_ api key is also added when a user signs up. The api key
  that's displayed in the Accounts and Integration pages is this default api key.
- The `users` collection contains a property called `accountId`, which locates the account id that
  the user belongs to. The `api.getAccount(loggedInUser.uid)` function is used to fetch the account.
- The `account` collection contains a fields called `isXandrIntegrationComplete`, `isIntegrationCheckSuccessful`,
  `showCrawledFeatures`. These three fields are boolean. 
- The `isIntegrationCheckSuccessful` shows is Edge Kit script integration was completed. 
  Marked `true` when integration check passes in the app. `isXandrIntegrationComplete` - `false` by default. 
  Currently only may be marked `true` manually in the firebase console. 
- `isXandrIntegrationComplete` and `isIntegrationCheckSuccessful` used as indicators for navbar 
  and welcome page integration statuses. 
- `showCrawledFeatures` another manual boolean to show banner after integration was complete before 
  crawled results.  
- `xandrId` - field used to match user revenues to account from `xandr`.`curator_analytics` table in BQ.


## Testing

### e2e tests

Run command `npm run test:e2e` for local testing.

To test other places use `--env` to overwrite parameters. 
To overwrite environment variables, for example to test production, 
we should install the new Cypress version `npm install -D cypress` and use it instead of the npm command.

For example to test demo site run `cypress run --env BASE_URL=demo.edgek.it`

Environment params:
- `BASE_URL` - Domain for test. 
- `LOGIN` - Email for login. 
- `PASSWORD` - Password. 
